{% extends "base.html" %}

{% block title %}{{ _('Reports') }}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h1><i class="fas fa-table"></i> {{ _('Reports') }}</h1>
</div>

<div class="card mb-4">
    <div class="card-header">
        <strong>{{ _('Query Filters') }}</strong>
    </div>
    <div class="card-body">
        <form method="GET" class="row g-3">
            <div class="col-md-4">
                <label class="form-label">{{ _('Keyword') }}</label>
                <input type="text" class="form-control" name="keyword" value="{{ keyword }}" placeholder="{{ _('Address / Name / Type') }}">
            </div>
            <div class="col-md-2">
                <label class="form-label">{{ _('Status') }}</label>
                <select class="form-select" name="status">
                    <option value="all" {% if status == 'all' %}selected{% endif %}>{{ _('All') }}</option>
                    <option value="vacant" {% if status == 'vacant' %}selected{% endif %}>{{ _('Vacant') }}</option>
                    <option value="occupied" {% if status == 'occupied' %}selected{% endif %}>{{ _('Occupied') }}</option>
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label">{{ _('Province') }}</label>
                <select class="form-select" name="province">
                    <option value="all" {% if province == 'all' %}selected{% endif %}>{{ _('All') }}</option>
                    {% for p in province_options %}
                        <option value="{{ p }}" {% if province == p %}selected{% endif %}>{{ p }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label">{{ _('City') }}</label>
                <select class="form-select" name="city">
                    <option value="all" {% if city == 'all' %}selected{% endif %}>{{ _('All') }}</option>
                    {% for c in city_options %}
                        <option value="{{ c }}" {% if city == c %}selected{% endif %}>{{ c }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label">{{ _('Contract Type') }}</label>
                <select class="form-select" name="contract_type">
                    <option value="all" {% if contract_type == 'all' %}selected{% endif %}>{{ _('All') }}</option>
                    <option value="landlord" {% if contract_type == 'landlord' %}selected{% endif %}>{{ _('Landlord') }}</option>
                    <option value="tenant" {% if contract_type == 'tenant' %}selected{% endif %}>{{ _('Tenant') }}</option>
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label">{{ _('Signed') }}</label>
                <select class="form-select" name="signed">
                    <option value="all" {% if signed == 'all' %}selected{% endif %}>{{ _('All') }}</option>
                    <option value="yes" {% if signed == 'yes' %}selected{% endif %}>{{ _('Signed') }}</option>
                    <option value="no" {% if signed == 'no' %}selected{% endif %}>{{ _('Unsigned') }}</option>
                </select>
            </div>
            <div class="col-12">
                <button type="submit" class="btn btn-primary"><i class="fas fa-search"></i> {{ _('Search') }}</button>
                <a class="btn btn-outline-secondary" href="{{ url_for('reports') }}">{{ _('Reset') }}</a>
            </div>
        </form>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-4">
        <div class="card">
            <div class="card-body text-center">
                <div class="text-muted">{{ _('Properties') }}</div>
                <div class="h4 mb-0">{{ properties|length }}</div>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card">
            <div class="card-body text-center">
                <div class="text-muted">{{ _('Landlord Contracts') }}</div>
                <div class="h4 mb-0">{{ landlord_contracts|length }}</div>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card">
            <div class="card-body text-center">
                <div class="text-muted">{{ _('Tenant Contracts') }}</div>
                <div class="h4 mb-0">{{ tenant_contracts|length }}</div>
            </div>
        </div>
    </div>
</div>

<div class="card mb-4">
    <div class="card-header">
        <strong>{{ _('Property Report') }}</strong>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-striped table-hover align-middle">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>{{ _('Address') }}</th>
                        <th>{{ _('Type') }}</th>
                        <th>{{ _('Area') }}</th>
                        <th>{{ _('Bedrooms') }}</th>
                        <th>{{ _('Bathrooms') }}</th>
                        <th>{{ _('Status') }}</th>
                        <th>{{ _('Monthly Rent') }}</th>
                        <th>{{ _('Description') }}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for property in properties %}
                    <tr>
                        <td>{{ property.id }}</td>
                        <td>{{ property.address or (property.province ~ ' ' ~ property.city ~ ' ' ~ property.district ~ ' ' ~ property.detailed_address) }}</td>
                        <td>{{ property.property_type }}</td>
                        <td>{{ property.area_sqm }}</td>
                        <td>{{ property.bedrooms }}</td>
                        <td>{{ property.bathrooms }}</td>
                        <td>{{ property.status }}</td>
                        <td>{{ property.monthly_rent_to_tenant }}</td>
                        <td>{{ property.description or '-' }}</td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="9" class="text-center text-muted">{{ _('No data') }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="card mb-4">
    <div class="card-header">
        <strong>{{ _('Landlord Contract Report') }}</strong>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-striped table-hover align-middle">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>{{ _('Property') }}</th>
                        <th>{{ _('Landlord') }}</th>
                        <th>{{ _('Start') }}</th>
                        <th>{{ _('End') }}</th>
                        <th>{{ _('Monthly Rent') }}</th>
                        <th>{{ _('Payment Method') }}</th>
                        <th>{{ _('Signed') }}</th>
                        <th>{{ _('Notes') }}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for contract in landlord_contracts %}
                    <tr>
                        <td>{{ contract.id }}</td>
                        <td>{{ contract.property.address or contract.property.detailed_address }}</td>
                        <td>{{ contract.landlord_name }}</td>
                        <td>{{ contract.start_date }}</td>
                        <td>{{ contract.end_date }}</td>
                        <td>{{ contract.monthly_rent }}</td>
                        <td>{{ contract.payment_method }}</td>
                        <td>{{ contract.signed and _('Yes') or _('No') }}</td>
                        <td>{{ contract.notes or '-' }}</td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="9" class="text-center text-muted">{{ _('No data') }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="card mb-4">
    <div class="card-header">
        <strong>{{ _('Tenant Contract Report') }}</strong>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-striped table-hover align-middle">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>{{ _('Property') }}</th>
                        <th>{{ _('Tenant') }}</th>
                        <th>{{ _('Start') }}</th>
                        <th>{{ _('End') }}</th>
                        <th>{{ _('Monthly Rent') }}</th>
                        <th>{{ _('Payment Method') }}</th>
                        <th>{{ _('Signed') }}</th>
                        <th>{{ _('Notes') }}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for contract in tenant_contracts %}
                    <tr>
                        <td>{{ contract.id }}</td>
                        <td>{{ contract.property.address or contract.property.detailed_address }}</td>
                        <td>{{ contract.tenant_name }}</td>
                        <td>{{ contract.start_date }}</td>
                        <td>{{ contract.end_date }}</td>
                        <td>{{ contract.monthly_rent }}</td>
                        <td>{{ contract.payment_method }}</td>
                        <td>{{ contract.signed and _('Yes') or _('No') }}</td>
                        <td>{{ contract.notes or '-' }}</td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="9" class="text-center text-muted">{{ _('No data') }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
